<h1>Sales Date Manager</h1><hr/>
<div class='form-horizontal'>
	<div class="form-group">
		<label for="room_type" class='col-md-3 control-label'>ประเภทห้อง / Room Type</label>
		<div class='col-md-4'>
			<select class='form-control' id='room_type' name='room_type' ></select>
		</div>
	</div>
	<div class="form-group">
		<label for="pack_id" class='col-md-3 control-label'>ประเภทแพ็กเกจ / Package Type</label>
		<div class='col-md-4'>
			<select class='form-control' id='pack_id' name='pack_id' ></select>
		</div>
	</div>
	<div class="form-group">
		<label for="price_id" class='col-md-3 control-label'>ประเภทราคา / Price Type</label>
		<div class='col-md-4'>
			<select class='form-control' id='price_id' name='price_id' ></select>
		</div>
	</div>
	<div class="form-group">
		<label for="price_id" class='col-md-3 control-label'>&nbsp;</label>
		<div class='col-md-9'>
			<button class='btn btn-success' id='btn_search' type='button' ><span class='glyphicon glyphicon-search'></span> Search</button>
		</div>
	</div>
	
</div>
<table class='table table-striped' id='data_loader'  >
</table>
<button class='btn btn-primary' onclick=page.show_modal("sales_date_add.html","Create&nbsp;Sales&nbsp;Date") ><span class='glyphicon glyphicon-plus'></span> Add</button>
<!--show modal-->
<!-- Modal -->
<div class="modal fade bs-example-modal-md" id="modaldialog" tabindex="-1" role="dialog" aria-labelledby="modaltitle">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content" >
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="modaltitle">&nbsp;</h4>
			</div>
			<div class="modal-body"  >
				<div id="modalcontent" style='height:auto;width:100%;'>
					loading...
				</div>
			</div>
		<div class='modal-footer'>
		<span id='error_msg'></span>
		</div>
    </div>
  </div>
</div>
<!--show modal-->
<script>
$(document).ready(function(){

//datasource='services/sales_date_service.php?type=list' 

	$.getJSON("services/room_service.php?type=listobject",function(resp){
		$.each(resp.result,function(id,data){
			var opt = new Option(data.title, data.id);
			$("#room_type").append(opt);
		});
		
		//default change value;
		$("#room_type").change();
	});	
	
	$("#room_type").change(function(){
		var id = this.value;
		$("#pack_id").html("");
		$.getJSON("services/package_service.php?type=listobject&room_type="+id,function(resp){
			$.each(resp.result,function(id,data){
				var opt = new Option(data.title, data.id);
				$("#pack_id").append(opt);
			});
		});	
	
	});
	
	$.getJSON("services/price_service.php?type=listobject",function(resp){
		$.each(resp.result,function(id,data){
			var opt = new Option(data.title, data.id);
			$("#price_id").append(opt);
		});
	});	

	$('#btn_search').click(function(){
	
		var room_type = $('#room_type').val();
		var pack_id = $('#pack_id').val();
		var price_id = $('#price_id').val();
		var endpoint = 'services/sales_date_service.php?type=list&room_type='+room_type+'&pack_id='+pack_id+'&price_id='+price_id;
		$('#data_loader').html("");
		$.getJSON(endpoint,function(resp){
		
		   $('#data_loader').html(resp.result);
		   
		   $('#data_loader').DataTable({
				"pagingType": "full_numbers"
			}); 
			
		});

	});
	
});
</script>
